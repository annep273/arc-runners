## Runner scale set values for ARC on OpenShift s390x
## Image repository/tag are set via --set in the install script

## githubConfigUrl and githubConfigSecret are set via --set in the install script
githubConfigUrl: ""
githubConfigSecret: arc-ghes-github-app

minRunners: 0
maxRunners: 10

runnerGroup: "Default"

## Container mode: "kubernetes" avoids privileged pods (OpenShift-friendly)
## Use "dind" only if SCC allows privileged containers
containerMode:
  type: "kubernetes"
  kubernetesModeWorkVolumeClaim:
    accessModes: ["ReadWriteOnce"]
    storageClassName: ""
    resources:
      requests:
        storage: 5Gi

## Runner pod template
## The chart auto-populates command, env, and volumes for the chosen containerMode
template:
  spec:
    ## Pod-level security: force non-root, set fs group for volume ownership
    securityContext:
      runAsNonRoot: true
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
      seccompProfile:
        type: RuntimeDefault
    containers:
      - name: runner
        image: "ghcr.io/actions/actions-runner:latest"
        command: ["/home/runner/run.sh"]
        imagePullPolicy: IfNotPresent
        ## Container-level security: drop all caps, no privilege escalation
        securityContext:
          runAsNonRoot: true
          runAsUser: 1001
          runAsGroup: 1001
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: false   # runner writes to _diag, _work, etc.
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            cpu: "500m"
            memory: "1Gi"
          limits:
            cpu: "2"
            memory: "4Gi"

## Listener pod template
## Leave name as "listener" so the chart applies config correctly
listenerTemplate:
  spec:
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      seccompProfile:
        type: RuntimeDefault
    containers:
      - name: listener
        imagePullPolicy: IfNotPresent
        securityContext:
          runAsNonRoot: true
          runAsUser: 1000
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            cpu: "100m"
            memory: "256Mi"
          limits:
            cpu: "500m"
            memory: "512Mi"

## Optional: controller service account reference
## Uncomment and set if the install script cannot auto-detect the controller SA
# controllerServiceAccount:
#   namespace: arc-systems
#   name: arc-gha-rs-controller
